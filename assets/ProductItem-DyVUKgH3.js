var oe=e=>{throw TypeError(e)};var V=(e,t,s)=>t.has(e)||oe("Cannot "+s);var i=(e,t,s)=>(V(e,t,"read from private field"),s?s.call(e):t.get(e)),p=(e,t,s)=>t.has(e)?oe("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,s),u=(e,t,s,r)=>(V(e,t,"write to private field"),r?r.call(e,s):t.set(e,s),s),m=(e,t,s)=>(V(e,t,"access private method"),s);import{S as ye,k as O,s as H,l as B,n as xe,m as he,o as ce,t as Re,p as Ce,q as Oe,v as le,w as pe,r as w,x as je,j as f,a as ue,P as b,L as Se}from"./index-DdubsRfB.js";import{L as we}from"./LazyLoadImage-b9_soscN.js";var v,a,M,g,I,F,C,k,N,D,Q,T,E,U,n,q,K,G,J,X,Y,Z,ee,ge,me,Ee=(me=class extends ye{constructor(t,s){super();p(this,n);p(this,v);p(this,a);p(this,M);p(this,g);p(this,I);p(this,F);p(this,C);p(this,k);p(this,N);p(this,D);p(this,Q);p(this,T);p(this,E);p(this,U,new Set);this.options=s,u(this,v,t),u(this,C,null),this.bindMethods(),this.setOptions(s)}bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(i(this,a).addObserver(this),de(i(this,a),this.options)?m(this,n,q).call(this):this.updateResult(),m(this,n,X).call(this))}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return te(i(this,a),this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return te(i(this,a),this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,m(this,n,Y).call(this),m(this,n,Z).call(this),i(this,a).removeObserver(this)}setOptions(t,s){const r=this.options,d=i(this,a);if(this.options=i(this,v).defaultQueryOptions(t),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof O(this.options.enabled,i(this,a))!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");m(this,n,ee).call(this),i(this,a).setOptions(this.options),r._defaulted&&!H(this.options,r)&&i(this,v).getQueryCache().notify({type:"observerOptionsUpdated",query:i(this,a),observer:this});const h=this.hasListeners();h&&fe(i(this,a),d,this.options,r)&&m(this,n,q).call(this),this.updateResult(s),h&&(i(this,a)!==d||O(this.options.enabled,i(this,a))!==O(r.enabled,i(this,a))||B(this.options.staleTime,i(this,a))!==B(r.staleTime,i(this,a)))&&m(this,n,K).call(this);const o=m(this,n,G).call(this);h&&(i(this,a)!==d||O(this.options.enabled,i(this,a))!==O(r.enabled,i(this,a))||o!==i(this,E))&&m(this,n,J).call(this,o)}getOptimisticResult(t){const s=i(this,v).getQueryCache().build(i(this,v),t),r=this.createResult(s,t);return Ie(this,r)&&(u(this,g,r),u(this,F,this.options),u(this,I,i(this,a).state)),r}getCurrentResult(){return i(this,g)}trackResult(t,s){const r={};return Object.keys(t).forEach(d=>{Object.defineProperty(r,d,{configurable:!1,enumerable:!0,get:()=>(this.trackProp(d),s==null||s(d),t[d])})}),r}trackProp(t){i(this,U).add(t)}getCurrentQuery(){return i(this,a)}refetch({...t}={}){return this.fetch({...t})}fetchOptimistic(t){const s=i(this,v).defaultQueryOptions(t),r=i(this,v).getQueryCache().build(i(this,v),s);return r.isFetchingOptimistic=!0,r.fetch().then(()=>this.createResult(r,s))}fetch(t){return m(this,n,q).call(this,{...t,cancelRefetch:t.cancelRefetch??!0}).then(()=>(this.updateResult(),i(this,g)))}createResult(t,s){var ne;const r=i(this,a),d=this.options,h=i(this,g),o=i(this,I),l=i(this,F),j=t!==r?t.state:i(this,M),{state:S}=t;let c={...S},L=!1,y;if(s._optimisticResults){const x=this.hasListeners(),z=!x&&de(t,s),ve=x&&fe(t,r,s,d);(z||ve)&&(c={...c,...Oe(S.data,t.options)}),s._optimisticResults==="isRestoring"&&(c.fetchStatus="idle")}let{error:A,errorUpdatedAt:ie,status:P}=c;if(s.select&&c.data!==void 0)if(h&&c.data===(o==null?void 0:o.data)&&s.select===i(this,k))y=i(this,N);else try{u(this,k,s.select),y=s.select(c.data),y=le(h==null?void 0:h.data,y,s),u(this,N,y),u(this,C,null)}catch(x){u(this,C,x)}else y=c.data;if(s.placeholderData!==void 0&&y===void 0&&P==="pending"){let x;if(h!=null&&h.isPlaceholderData&&s.placeholderData===(l==null?void 0:l.placeholderData))x=h.data;else if(x=typeof s.placeholderData=="function"?s.placeholderData((ne=i(this,D))==null?void 0:ne.state.data,i(this,D)):s.placeholderData,s.select&&x!==void 0)try{x=s.select(x),u(this,C,null)}catch(z){u(this,C,z)}x!==void 0&&(P="success",y=le(h==null?void 0:h.data,x,s),L=!0)}i(this,C)&&(A=i(this,C),y=i(this,N),ie=Date.now(),P="error");const _=c.fetchStatus==="fetching",W=P==="pending",$=P==="error",re=W&&_,ae=y!==void 0;return{status:P,fetchStatus:c.fetchStatus,isPending:W,isSuccess:P==="success",isError:$,isInitialLoading:re,isLoading:re,data:y,dataUpdatedAt:c.dataUpdatedAt,error:A,errorUpdatedAt:ie,failureCount:c.fetchFailureCount,failureReason:c.fetchFailureReason,errorUpdateCount:c.errorUpdateCount,isFetched:c.dataUpdateCount>0||c.errorUpdateCount>0,isFetchedAfterMount:c.dataUpdateCount>j.dataUpdateCount||c.errorUpdateCount>j.errorUpdateCount,isFetching:_,isRefetching:_&&!W,isLoadingError:$&&!ae,isPaused:c.fetchStatus==="paused",isPlaceholderData:L,isRefetchError:$&&ae,isStale:se(t,s),refetch:this.refetch}}updateResult(t){const s=i(this,g),r=this.createResult(i(this,a),this.options);if(u(this,I,i(this,a).state),u(this,F,this.options),i(this,I).data!==void 0&&u(this,D,i(this,a)),H(r,s))return;u(this,g,r);const d={},h=()=>{if(!s)return!0;const{notifyOnChangeProps:o}=this.options,l=typeof o=="function"?o():o;if(l==="all"||!l&&!i(this,U).size)return!0;const R=new Set(l??i(this,U));return this.options.throwOnError&&R.add("error"),Object.keys(i(this,g)).some(j=>{const S=j;return i(this,g)[S]!==s[S]&&R.has(S)})};(t==null?void 0:t.listeners)!==!1&&h()&&(d.listeners=!0),m(this,n,ge).call(this,{...d,...t})}onQueryUpdate(){this.updateResult(),this.hasListeners()&&m(this,n,X).call(this)}},v=new WeakMap,a=new WeakMap,M=new WeakMap,g=new WeakMap,I=new WeakMap,F=new WeakMap,C=new WeakMap,k=new WeakMap,N=new WeakMap,D=new WeakMap,Q=new WeakMap,T=new WeakMap,E=new WeakMap,U=new WeakMap,n=new WeakSet,q=function(t){m(this,n,ee).call(this);let s=i(this,a).fetch(this.options,t);return t!=null&&t.throwOnError||(s=s.catch(xe)),s},K=function(){m(this,n,Y).call(this);const t=B(this.options.staleTime,i(this,a));if(he||i(this,g).isStale||!ce(t))return;const r=Re(i(this,g).dataUpdatedAt,t)+1;u(this,Q,setTimeout(()=>{i(this,g).isStale||this.updateResult()},r))},G=function(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(i(this,a)):this.options.refetchInterval)??!1},J=function(t){m(this,n,Z).call(this),u(this,E,t),!(he||O(this.options.enabled,i(this,a))===!1||!ce(i(this,E))||i(this,E)===0)&&u(this,T,setInterval(()=>{(this.options.refetchIntervalInBackground||Ce.isFocused())&&m(this,n,q).call(this)},i(this,E)))},X=function(){m(this,n,K).call(this),m(this,n,J).call(this,m(this,n,G).call(this))},Y=function(){i(this,Q)&&(clearTimeout(i(this,Q)),u(this,Q,void 0))},Z=function(){i(this,T)&&(clearInterval(i(this,T)),u(this,T,void 0))},ee=function(){const t=i(this,v).getQueryCache().build(i(this,v),this.options);if(t===i(this,a))return;const s=i(this,a);u(this,a,t),u(this,M,t.state),this.hasListeners()&&(s==null||s.removeObserver(this),t.addObserver(this))},ge=function(t){pe.batch(()=>{t.listeners&&this.listeners.forEach(s=>{s(i(this,g))}),i(this,v).getQueryCache().notify({query:i(this,a),type:"observerResultsUpdated"})})},me);function Pe(e,t){return O(t.enabled,e)!==!1&&e.state.data===void 0&&!(e.state.status==="error"&&t.retryOnMount===!1)}function de(e,t){return Pe(e,t)||e.state.data!==void 0&&te(e,t,t.refetchOnMount)}function te(e,t,s){if(O(t.enabled,e)!==!1){const r=typeof s=="function"?s(e):s;return r==="always"||r!==!1&&se(e,t)}return!1}function fe(e,t,s,r){return(e!==t||O(r.enabled,e)===!1)&&(!s.suspense||e.state.status!=="error")&&se(e,s)}function se(e,t){return O(t.enabled,e)!==!1&&e.isStaleByTime(B(t.staleTime,e))}function Ie(e,t){return!H(e.getCurrentResult(),t)}var be=w.createContext(!1),Qe=()=>w.useContext(be);be.Provider;function Te(){let e=!1;return{clearReset:()=>{e=!1},reset:()=>{e=!0},isReset:()=>e}}var Fe=w.createContext(Te()),Ne=()=>w.useContext(Fe);function De(e,t){return typeof e=="function"?e(...t):!!e}var Ue=(e,t)=>{(e.suspense||e.throwOnError)&&(t.isReset()||(e.retryOnMount=!1))},Le=e=>{w.useEffect(()=>{e.clearReset()},[e])},qe=({result:e,errorResetBoundary:t,throwOnError:s,query:r})=>e.isError&&!t.isReset()&&!e.isFetching&&r&&De(s,[e.error,r]),Me=e=>{e.suspense&&(typeof e.staleTime!="number"&&(e.staleTime=1e3),typeof e.gcTime=="number"&&(e.gcTime=Math.max(e.gcTime,1e3)))},ke=(e,t)=>(e==null?void 0:e.suspense)&&t.isPending,Ae=(e,t,s)=>t.fetchOptimistic(e).catch(()=>{s.clearReset()});function Be(e,t,s){var j,S,c,L;const r=je(),d=Qe(),h=Ne(),o=r.defaultQueryOptions(e);(S=(j=r.getDefaultOptions().queries)==null?void 0:j._experimental_beforeQuery)==null||S.call(j,o),o._optimisticResults=d?"isRestoring":"optimistic",Me(o),Ue(o,h),Le(h);const[l]=w.useState(()=>new t(r,o)),R=l.getOptimisticResult(o);if(w.useSyncExternalStore(w.useCallback(y=>{const A=d?()=>{}:l.subscribe(pe.batchCalls(y));return l.updateResult(),A},[l,d]),()=>l.getCurrentResult(),()=>l.getCurrentResult()),w.useEffect(()=>{l.setOptions(o,{listeners:!1})},[o,l]),ke(o,R))throw Ae(o,l,h);if(qe({result:R,errorResetBoundary:h,throwOnError:o.throwOnError,query:r.getQueryCache().get(o.queryHash)}))throw R.error;return(L=(c=r.getDefaultOptions().queries)==null?void 0:c._experimental_afterQuery)==null||L.call(c,o,R),o.notifyOnChangeProps?R:l.trackResult(R)}function _e(e,t){return Be(e,Ee)}function Ge({error:e}){return f.jsx(f.Fragment,{children:f.jsxs("div",{className:"flex items-center justify-center gap-3 p-4 mb-4 text-sm text-red-800 rounded-lg bg-red-50 dark:text-red-400",role:"alert",children:[f.jsx("i",{className:"fa-solid fa-circle-exclamation fa-2x mt-1"}),f.jsx("span",{className:"text-3xl font-medium",children:e})]})})}async function We(){const e=await ue.get("https://ecommerce.routemisr.com/api/v1/products"),{currentPage:t,numberOfPages:s}=e.data.metadata;let r=e.data.data;if(s>t){const d=[];for(let l=2;l<=s;l++)d.push(ue.get(`https://ecommerce.routemisr.com/api/v1/products?page=${l}`));const o=(await Promise.all(d)).flatMap(l=>l.data.data);r=[...r,...o]}return r}function Je(e){return _e({queryKey:["products",e],queryFn:()=>We(),staleTime:6e4,refetchInterval:6e4,refetchIntervalInBackground:!0,retry:3,retryDelay:0})}function $e({product:e,addProductToWishlist:t,addProduct:s,loading:r,currentProductId:d,isInWishlist:h,removeProductFromWishlist:o}){return f.jsx("div",{className:"px-2 py-2 w-full sm:w-1/2 md:w-1/3",children:f.jsxs("div",{className:"shadow-md bg-gray-50 p-3 hover:shadow-lg transition-all duration-500",children:[f.jsxs(Se,{to:`/productDetails/${e.category.name}/${e.id}`,className:"group",children:[f.jsx("div",{className:"overflow-hidden mb-2",children:f.jsx(we,{className:"object-cover h-72",src:e.imageCover,alt:e.title})}),f.jsx("p",{className:"text-green-600 text-sm mb-2",children:e.category.name}),f.jsx("h2",{className:"text-gray-950 line-clamp-1 mb-1 font-medium",children:e.title}),f.jsxs("div",{className:"flex mb-2 items-center justify-between",children:[f.jsxs("span",{children:[e.price," EGP"]}),f.jsxs("span",{className:"flex items-center text-sm",children:[e.ratingsAverage,f.jsx("i",{className:"text-yellow-400 ml-1 text-xs fa-solid fa-star"})]})]})]}),f.jsxs("div",{className:"flex justify-between items-center mt-2 gap-2",children:[f.jsx("button",{onClick:()=>s(e.id),className:" transition-all duration-500 text-green-600 font-bold",children:r&&d==e.id?f.jsx("i",{className:"fas fa-spin fa-spinner text-xl"}):f.jsx("i",{className:"fa-solid fa-cart-plus text-2xl"})}),f.jsx("button",{onClick:()=>h?o(e.id):t(e.id),children:f.jsx("i",{className:`${h?"fa-solid":"fa-regular"} fa-heart fa-xl text-green-600`})})]})]})})}$e.propTypes={product:b.shape({id:b.string.isRequired,title:b.string.isRequired,price:b.number.isRequired,imageCover:b.string.isRequired,category:b.shape({name:b.string.isRequired}).isRequired,ratingsAverage:b.number.isRequired}).isRequired,addProductToWishlist:b.func.isRequired,addProduct:b.func.isRequired,loading:b.bool.isRequired,currentProductId:b.string,isInWishlist:b.bool,removeProductFromWishlist:b.func.isRequired};export{Ge as E,$e as P,Je as a,_e as u};
