import{r as d,a as m,b as B,j as e}from"./index-DdubsRfB.js";import{a as N}from"./ProductItem-DyVUKgH3.js";import{H as S,a as y}from"./index.esm-CpHPOVxb.js";import{P as E}from"./ProductList-kmfFR5ne.js";import"./LazyLoadImage-b9_soscN.js";import"./BeatLoader-DoOWqFl8.js";function H(){const[p,h]=d.useState([]),[g,x]=d.useState([]),[u,f]=d.useState([]),{data:b,isError:v,error:P,isLoading:j}=N();d.useEffect(()=>{w(),C()},[]);async function w(){const a=await m.get("https://ecommerce.routemisr.com/api/v1/brands"),{currentPage:c,numberOfPages:n}=a.data.metadata;let t=a.data.data;if(n>c){const l=[];for(let i=2;i<=n;i++)l.push(m.get(`https://ecommerce.routemisr.com/api/v1/brands?page=${i}`));const o=(await Promise.all(l)).flatMap(i=>i.data.data);t=[...t,...o]}h(t)}async function C(){const a=await m.get("https://ecommerce.routemisr.com/api/v1/categories");x(a.data.data)}const s=B({initialValues:{minPrice:"",maxPrice:"",brand:"",selectedCategories:[]},onSubmit:k});function k(a){const{brand:c,maxPrice:n,minPrice:t,selectedCategories:l}=a,r=[];c&&r.push(`brand=${c}`),n&&r.push(`price[gte]=${n}`),t&&r.push(`price[lte]=${t}`),l.length>0&&r.push(`category[in]=${l.join(",")}`),m.get(`https://ecommerce.routemisr.com/api/v1/products?${r.join("&")}`).then(o=>{f(o.data.data)}).catch(o=>console.log(o))}return e.jsxs(S,{children:[e.jsx(y,{children:e.jsx("title",{children:"Products"})}),e.jsx("h1",{className:"text-4xl font-bold text-green-600 mb-8 text-center",children:"Products"}),e.jsxs("div",{className:"flex flex-wrap items-start",children:[e.jsxs("form",{onSubmit:s.handleSubmit,className:"sm:w-1/4 flex flex-wrap gap-2 p-2",children:[e.jsxs("select",{name:"brand",value:s.values.brand,onChange:s.handleChange,onBlur:s.handleBlur,className:"focus:outline-none block w-full p-2 border rounded",children:[e.jsx("option",{value:"",children:"Select Brand"}),p.map(a=>e.jsx("option",{value:a._id,children:a.name},a._id))]}),e.jsx("input",{type:"number",name:"minPrice",min:0,onBlur:s.handleBlur,onChange:s.handleChange,value:s.values.minPrice,placeholder:"Min Price",className:"p-2 block w-full border rounded focus:outline-none"}),e.jsx("input",{type:"number",name:"maxPrice",min:0,onBlur:s.handleBlur,onChange:s.handleChange,value:s.values.maxPrice,placeholder:"Max Price",className:" block w-full p-2 border rounded focus:outline-none"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"text-sm",children:"Select Category :"}),g.map(a=>e.jsxs("div",{className:"inline-flex sm:flex items-center mr-2 sm:mr-0",children:[e.jsx("input",{type:"checkbox",name:"selectedCategories",value:a._id,id:a._id,onChange:s.handleChange,onBlur:s.handleBlur,checked:s.values.selectedCategories.includes(a._id),className:"h-4 w-4 appearance-none border border-gray-300 rounded checked:bg-green-600 checked:border-transparent checked:focus:ring-green-500",style:{backgroundImage:"url('data:image/svg+xml;utf8,%3Csvg viewBox%3D%220 0 16 16%22 fill%3D%22white%22 xmlns%3D%22http://www.w3.org/2000/svg%22%3E%3Cpath d%3D%22M12.146 4.854a.5.5 0 0 1 0 .708l-6 6a.5.5 0 0 1-.708 0l-3-3a.5.5 0 1 1 .708-.708L6 10.293l5.646-5.647a.5.5 0 0 1 .708 0z%22/%3E%3C/svg%3E')",backgroundPosition:"center",backgroundSize:"75%",backgroundRepeat:"no-repeat"}}),e.jsx("label",{htmlFor:a._id,className:"ml-2 block text-sm text-gray-700",children:a.name})]},a._id))]}),e.jsx("button",{type:"submit",className:" p-2 block w-full bg-green-700 text-white rounded",children:"Filter"})]}),e.jsx("div",{className:"sm:w-3/4",children:e.jsx(E,{data:u.length>0?u:b,isError:v,error:P,isLoading:j})})]})]})}export{H as default};
